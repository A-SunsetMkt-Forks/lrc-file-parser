/*!
 * lrc-file-parser.js v2.3.0
 * Author: lyswhut
 * Github: https://github.com/lyswhut/lrc-file-parser
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Lyric",[],e):"object"==typeof exports?exports.Lyric=e():t.Lyric=e()}(self,(()=>{return t={579:t=>{function e(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(r=n.key,a=void 0,a=function(t,e){if("object"!==o(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(r,"string"),"symbol"===o(a)?a:String(a)),n)}var r,a}function r(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=a(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,u=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){u=!0,s=t},f:function(){try{o||null==i.return||i.return()}finally{if(u)throw s}}}}function a(t,e){if(t){if("string"==typeof t)return s(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}var u=/^(?:\[[\d:.]+\])+/g,l=/[\d:.]+/g,c=/^(\[[\d:]+\.)0+(\d+\])/,h=/(?:\.0+|0+)$/,f={title:"ti",artist:"ar",album:"al",offset:"offset",by:"by"},m="object"==("undefined"==typeof performance?"undefined":o(performance))&&performance.now?performance.now.bind(performance):Date.now.bind(Date),y={invokeTime:0,animationFrameId:null,timeoutId:null,callback:null,thresholdTime:200,run:function(){var t=this;this.animationFrameId=window.requestAnimationFrame((function(){t.animationFrameId=null;var e=t.invokeTime-m();if(e>0)return e<t.thresholdTime?t.run():t.timeoutId=setTimeout((function(){t.timeoutId=null,t.run()}),e-t.thresholdTime);t.callback(e)}))},start:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.callback=t,this.invokeTime=m()+e,this.run()},clear:function(){this.animationFrameId&&(window.cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=null)}},d=function(t,e){for(var i=e.split(/\r\n|\n|\r/),n=0;n<i.length;n++){var a=i[n].trim(),s=u.exec(a);if(s){var o=s[0],f=a.replace(u,"").trim();if(f){var m=o.match(l);if(null==m)continue;var y,d=r(m);try{for(d.s();!(y=d.n()).done;){var v=y.value;v.includes(".")?v=v.replace(c,"$1$2"):v+=".0";var p=t[v.replace(h,"")];p&&p.extendedLyrics.push(f)}}catch(t){d.e(t)}finally{d.f()}}}}};t.exports=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.lyric,r=void 0===n?"":n,a=e.extendedLyrics,s=void 0===a?[]:a,o=e.offset,u=void 0===o?150:o,l=e.playbackRate,c=void 0===l?1:l,h=e.onPlay,f=void 0===h?function(){}:h,m=e.onSetLyric,y=void 0===m?function(){}:m,d=e.isRemoveBlankLine,v=void 0===d||d;i(this,t),this.lyric=r,this.extendedLyrics=s,this.tags={},this.lines=null,this.onPlay=f,this.onSetLyric=y,this.isPlay=!1,this.curLineNum=0,this.maxLine=0,this.offset=u,this._playbackRate=c,this._performanceTime=0,this._startTime=0,this.isRemoveBlankLine=v,this._init()}var a,s,o;return a=t,s=[{key:"_init",value:function(){null==this.lyric&&(this.lyric=""),null==this.extendedLyrics&&(this.extendedLyrics=[]),this._initTag(),this._initLines(),this.onSetLyric(this.lines)}},{key:"_initTag",value:function(){for(var t in this.tags={},f){var e=this.lyric.match(new RegExp("\\[".concat(f[t],":([^\\]]*)]"),"i"));this.tags[t]=e&&e[1]||""}if(this.tags.offset){var i=parseInt(this.tags.offset);this.tags.offset=Number.isNaN(i)?0:i}else this.tags.offset=0}},{key:"_initLines",value:function(){this.lines=[];for(var t=this.lyric.split(/\r\n|\n|\r/),i={},n=t.length,a=0;a<n;a++){var s=t[a].trim(),o=u.exec(s);if(o){var f=o[0],m=s.replace(u,"").trim();if(m||!this.isRemoveBlankLine){var y=f.match(l);if(null==y)continue;var v,p=r(y);try{for(p.s();!(v=p.n()).done;){var b=v.value;b.includes(".")?b=b.replace(c,"$1$2"):b+=".0";var L=b.replace(h,"");if(i[L])i[L].extendedLyrics.push(m);else{var g=L.split(":");g.length<3&&g.unshift(0),g[2].indexOf(".")>-1&&(g.push.apply(g,e(g[2].split("."))),g.splice(2,1)),i[L]={time:60*parseInt(g[0])*60*1e3+60*parseInt(g[1])*1e3+1e3*parseInt(g[2])+parseInt(g[3]||0),text:m,extendedLyrics:[]}}}}catch(t){p.e(t)}finally{p.f()}}}}var _,x=r(this.extendedLyrics);try{for(x.s();!(_=x.n()).done;){var k=_.value;d(i,k)}}catch(t){x.e(t)}finally{x.f()}this.lines=Object.values(i),this.lines.sort((function(t,e){return t.time-e.time})),this.maxLine=this.lines.length-1}},{key:"_currentTime",value:function(){return(m()-this._performanceTime)*this._playbackRate+this._startTime}},{key:"_findCurLineNum",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t<=0)return 0;for(var i=this.lines.length,n=e;n<i;n++)if(t<=this.lines[n].time)return 0===n?0:n-1;return i-1}},{key:"_handleMaxLine",value:function(){this.onPlay(this.curLineNum,this.lines[this.curLineNum].text),this.pause()}},{key:"_refresh",value:function(){var t=this;if(this.curLineNum++,this.curLineNum>=this.maxLine)return this._handleMaxLine();var e=this.lines[this.curLineNum],i=this._currentTime(),n=i-e.time;if(n>=0||0===this.curLineNum){var r=(this.lines[this.curLineNum+1].time-e.time-n)/this._playbackRate;if(r>0)return this.isPlay&&y.start((function(){t.isPlay&&t._refresh()}),r),void this.onPlay(this.curLineNum,e.text);var a=this._findCurLineNum(i,this.curLineNum+1);return a>this.curLineNum&&(this.curLineNum=a-1),void this._refresh()}this.curLineNum=this._findCurLineNum(i,this.curLineNum)-1,this._refresh()}},{key:"play",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.lines.length&&(this.pause(),this.isPlay=!0,this._performanceTime=m()-parseInt(this.tags.offset+this.offset),this._startTime=t,this.curLineNum=this._findCurLineNum(this._currentTime())-1,this._refresh())}},{key:"pause",value:function(){if(this.isPlay&&(this.isPlay=!1,y.clear(),this.curLineNum!==this.maxLine)){var t=this._findCurLineNum(this._currentTime());this.curLineNum!==t&&(this.curLineNum=t,this.onPlay(t,this.lines[t].text))}}},{key:"setPlaybackRate",value:function(t){this._playbackRate=t,this.lines.length&&this.isPlay&&this.play(this._currentTime())}},{key:"setLyric",value:function(t,e){this.isPlay&&this.pause(),this.lyric=t,this.extendedLyrics=e,this._init()}}],s&&n(a.prototype,s),o&&n(a,o),Object.defineProperty(a,"prototype",{writable:!1}),t}()}},e={},i=function i(n){var r=e[n];if(void 0!==r)return r.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,i),a.exports}(579),i;var t,e,i}));